Diccionario de datos extendido — Módulo Inventario (LES) · v0.21) inv_item (Pieza / entidad troncal)Propósito: representa una pieza única de inventario, con su clasificación y estado actual.RF: RF-INV-002/003 (unicidad), 010–013 (alta/identificación/ficha), 020–024 (estado), 036 (ficha dinámica).PKitem_id (UUID/ULID) — ID único no reutilizable (UNIQUE, NOT NULL) → RF-INV-002/003 02-01 - DOCUMENTO RFCampositem_code (string) — código visible autogenerado (UNIQUE) → RF-INV-011 02-01 - DOCUMENTO RFitem_qr_value (string) — QR autogenerado ligado a item_id (UNIQUE) → RF-INV-012 02-01 - DOCUMENTO RFcategory_id (FK) → inv_category.category_id (NOT NULL) → RF-INV-030 02-01 - DOCUMENTO RFsubcategory_id (FK) → inv_subcategory.subcategory_id (NOT NULL) → RF-INV-031/036operational_state_id (FK) → inv_operational_state.state_id (NOT NULL) → RF-INV-020/021location_id (FK) → inv_location.location_id (NOT NULL) → RF-INV-040/042created_at, created_by, updated_at, updated_by (audit) → soporte a trazabilidad mínima → RF-13 (no funcional ligado a funcional)last_movement_at (datetime) — fecha último movimiento (derivable o persistible) → RF-INV-013/044is_active (bool) — baja lógica (si aplica)Reglas de integridadUnicidad global de item_id y no duplicidad de pieza activa → RF-INV-002/003 02-01 - DOCUMENTO RFNo se permite cambiar estado/ubicación sin registrar movimiento → RF-INV-041 02-01 - DOCUMENTO RFLa ficha completa debe poder consultarse con estado/ubicación/clasificación/atributos/historial → RF-INV-013 02-01 - DOCUMENTO RF2) inv_category (Categorías)Propósito: catálogo de categorías normalizadas. (Anexo A) 01-02 - FRaD - Anexo A - Clasif…RF: RF-INV-030 02-01 - DOCUMENTO RFPK category_idCamposcategory_name (string) (UNIQUE)category_code (string) (opcional, UNIQUE)is_active (bool)sort_order (int)ReglasCatálogo estable; subcategorías dependen de categoría. 01-02 - FRaD - Anexo A - Clasif…3) inv_subcategory (Subcategorías)Propósito: catálogo de subcategorías por categoría. (Anexo A) 01-02 - FRaD - Anexo A - Clasif…RF: RF-INV-031 02-01 - DOCUMENTO RFPK subcategory_idCamposcategory_id (FK) (NOT NULL)subcategory_name (string) (UNIQUE dentro de categoría)subcategory_code (string) (opcional)is_active (bool)sort_order (int)ReglasUna pieza pertenece a una categoría y una subcategoría (modelo de clasificación). 01-02 - FRaD - Anexo A - Clasif…4) inv_attribute (Atributos reutilizables)Propósito: catálogo global de atributos definidos una sola vez (Anexo B). 01-02 - FRaD - Anexo B - Atribu…RF: RF-INV-032 02-01 - DOCUMENTO RFPK attribute_idCamposattribute_key (string) — identificador funcional único (UNIQUE)attribute_label (string) — etiqueta UXdata_type (enum: text/number/boolean/list/range/date, etc.) → tipado de validacióndomain_id (FK, nullable) → inv_domain.domain_id (solo si “lista controlada”)description (text)is_active (bool)ReglasNo se crean atributos ad-hoc: “un atributo se define una sola vez y se reutiliza”. 01-02 - FRaD - Anexo B - Atribu…5) inv_subcategory_attribute (Atributos por subcategoría)Propósito: define el comportamiento de la ficha dinámica por subcategoría: obligatoriedad, orden y reglas. (Anexo C) 01-02 - FRaD - Anexo C - Defini…RF: RF-INV-033 (+ RF-INV-036).PK subcat_attr_idCampossubcategory_id (FK) (NOT NULL)attribute_id (FK) (NOT NULL)requirement_level (enum: O/OP/C/NA) → Anexo C 01-02 - FRaD - Anexo C - Defini…display_order (int) → “orden de visualización” (RF-INV-033) 02-01 - DOCUMENTO RFcondition_expression (text, nullable) — regla condicional (solo si C)ui_group (string, nullable) — agrupación UX (sin alterar reglas)is_active (bool)Restricciones(subcategory_id, attribute_id) UNIQUESi requirement_level='C' entonces condition_expression NOT NULLSi requirement_level='NA' no debe mostrarse ni guardarse. 01-02 - FRaD - Anexo C - Defini…6) inv_domain (Dominios de valores)Propósito: define dominios (cerrado / semi-cerrado) para atributos tipo lista. (Anexo D) 01-02 - FRaD - Anexo D - Domini…RF: RF-INV-034 02-01 - DOCUMENTO RFPK domain_idCamposdomain_name (string) (UNIQUE)domain_type (enum: closed / semi_closed)description (text)is_active (bool)ReglasEl sistema impide valores fuera de dominio; semi-cerrado requiere justificación y auditoría. 01-02 - FRaD - Anexo D - Domini…7) inv_domain_value (Valores de dominio)Propósito: valores seleccionables por el usuario para atributos con dominio. (Anexo D) 01-02 - FRaD - Anexo D - Domini…RF: RF-INV-035 02-01 - DOCUMENTO RFPK domain_value_idCamposdomain_id (FK) (NOT NULL)value_code (string) (opcional)value_label (string) (NOT NULL)sort_order (int)is_active (bool)Restricciones(domain_id, value_label) UNIQUE8) inv_item_attribute_value (Valores de atributos por pieza)Propósito: persistencia de la ficha dinámica: qué valor tiene cada atributo en cada pieza, gobernado por Anexos B–C–D.RF: RF-INV-013 (consulta ficha), 032–036 (atributos, asignación, dominios, ficha dinámica).PK item_attr_value_idCampositem_id (FK) (NOT NULL)attribute_id (FK) (NOT NULL)value_text (nullable)value_number (nullable)value_bool (nullable)domain_value_id (FK, nullable) — si el atributo tiene dominiovalue_date (nullable)justification (text, nullable) — obligatorio cuando el dominio es semi-cerrado y se usa valor “extendido” (según política del dominio) 01-02 - FRaD - Anexo D - Domini…created_at/by, updated_at/byRestricciones(item_id, attribute_id) UNIQUEValidación tipada según inv_attribute.data_typeSi el atributo tiene dominio: debe informarse domain_value_id y pertenecer al dominio correcto. 01-02 - FRaD - Anexo D - Domini…Bloqueo de guardado si faltan obligatorios (O) o condicionales (C) activados.9) inv_operational_state (Estados operativos)Propósito: catálogo de estados operativos (configurable). (Anexo D / RF-INV)RF: RF-INV-021 (+ 020/022/024). 02-01 - DOCUMENTO RFPK state_idCamposstate_name (string) (UNIQUE)is_final (bool) — p.ej. “Vendida (cerrada)” → reglas de cierre 02-01 - DOCUMENTO RFis_active (bool)sort_order (int)10) inv_location (Ubicaciones)Propósito: catálogo de ubicaciones (tienda, almacén, taller externo, tránsito). (Anexo D) 01-02 - FRaD - Anexo D - Domini…RF: se usa por movimientos y datos obligatorios de movimiento → RF-INV-040/042PK location_idCamposlocation_type (enum: shop/warehouse/external_workshop/in_transit)location_name (string) (UNIQUE)is_active (bool)11) inv_movement (Movimientos de inventario)Propósito: historial inmutable de cambios por evento (estado/ubicación/acciones).RF: RF-INV-040–044 (registro obligatorio, bloqueo sin movimiento, datos mínimos, doc opcional, historial).PK movement_idCampos obligatorios (RF-INV-042)item_id (FK) (NOT NULL)performed_by (FK a usuario) (NOT NULL)performed_at (datetime) (NOT NULL)from_location_id (FK, nullable según evento)to_location_id (FK, nullable según evento)reason (text / enum+text) (NOT NULL)Camposevent_type (enum: alta/venta/apartado/reparación/recepción/transferencia/ajuste/devolución/abono, etc.) → RF-INV-040 02-01 - DOCUMENTO RFfrom_state_id (FK) / to_state_id (FK) (según evento)related_document_type (nullable) / related_document_id (nullable) → RF-INV-043 02-01 - DOCUMENTO RF12) inv_reservation (Apartados)Propósito: reserva/apartado con fechas y caducidad; controla bloqueo y decisiones admin.RF: RF-INV-050–055 (por casos de prueba).PK reservation_idCampositem_id (FK) (NOT NULL, UNIQUE cuando “activa”)customer_id (FK) (NOT NULL)reserved_at (datetime) (NOT NULL)expires_at (datetime) (NOT NULL)status (enum: active/expired/released/converted_to_sale)admin_decision (enum, nullable) — para caducados (volver a disponible / etc.)decision_reason (text, nullable)created_by, created_atRegla troncalAl crear apartado: estado pieza pasa a “Reservada/Apartada” y queda vinculada a cliente. 02-03 - Casos de prueba13) inv_repair_order (Reparaciones / personalizaciones)Propósito: órdenes de taller y control de salida/entrada; soporta “venta + reparación” sin romper integridad.RF: RF-INV-060–064 (matriz y test cases).PK repair_order_idCampositem_id (FK) (NOT NULL)workshop_id (FK) (NOT NULL)customer_id (FK, nullable según caso)opened_at (datetime), sent_at (datetime), received_at (datetime)status (enum: open/sent/received/closed/cancelled)notes (text)created_by, created_at14) inv_warranty (Garantías)Propósito: garantía vinculada a pieza+venta con inicio en fecha de venta. 02-03 - Casos de pruebaRF: RF-INV-070–072 (test cases). 02-03 - Casos de pruebaPK warranty_idCampositem_id (FK) (NOT NULL)sale_id (FK a ventas, módulo externo LES) (NOT NULL)starts_at (date) (NOT NULL)ends_at (date, nullable según política)status (enum)terms_ref (text/uri, opcional)15) inv_label_print_log (Etiquetas: impresión / reimpresión)Propósito: auditoría de impresión y reimpresión; contenido mínimo de etiqueta.RF: RF-INV-090–092 (matriz + test cases).PK label_log_idCampositem_id (FK) (NOT NULL)printed_by (FK usuario) (NOT NULL)printed_at (datetime) (NOT NULL)action (enum: print/reprint) (NOT NULL)label_payload_snapshot (json/text) — incluye barcode(item_code) + QR(item_id) + descripción (según RF-091)reason (text, nullable; recomendado en reprint)16) inv_customer (Clientes)Propósito: CRUD clientes vinculables a apartados/ventas/encargos.RF: RF-INV-100–101 02-04 - MATRIZ PANTALLAPK customer_idCampos típicos: full_name, doc_id, phone, email, is_active, created_at/by17) inv_workshop (Talleres externos)Propósito: catálogo de talleres para órdenes de reparación/personalización.RF: RF-INV-102–103 02-04 - MATRIZ PANTALLAPK workshop_idCampos: name, contact, service_types, is_active18) inv_supplier (Proveedores)Propósito: CRUD proveedores (cuando aplique en compras).RF: RF-INV-104 02-04 - MATRIZ PANTALLAPK supplier_idCampos: name, contact, is_active19) sec_role, sec_permission, sec_role_permission, sec_user (Seguridad: roles y permisos)Propósito: control de acceso y capacidades por rol (dependienta/admin), incluyendo restricciones.RF: RF-INV-080–084sec_rolerole_id (PK), role_name (UNIQUE), is_activesec_permissionpermission_id (PK), permission_key (UNIQUE), descriptionsec_role_permissionrole_id (FK), permission_id (FK), (role_id, permission_id) UNIQUEsec_useruser_id (PK), username (UNIQUE), role_id (FK), is_activeNotas de gobierno técnico (para que sea “implementable sin interpretación”)La obligatoriedad no vive en inv_attribute; vive en inv_subcategory_attribute (Anexo C).Los valores controlados no se guardan como texto libre si hay dominio: se guardan como FK a inv_domain_value. (Anexo D) 01-02 - FRaD - Anexo D - Domini…Cualquier cambio de estado/ubicación debe crear inv_movement; si no, debe bloquearse.
