A10.1 - 🧭 WIZARD DE ALTA DE PIEZA · UX FUNCIONAL (LES)ID UX: UX-INV-WZ-01Caso de uso base: UC-INV-01Reglas aplicadas: SR-01, SR-03, SR-04Patrón aplicado: LES-UX-PATTERN-CVISIÓN GENERAL DEL WIZARDEstructura: Wizard secuencial en 4 pasosRegla troncal:No se puede finalizar el wizard si el modelo funcional no queda en estado válido y consistente.PasoNombreObjetivo1ClasificaciónDeterminar estructura de ficha2CaracterísticasIntroducir atributos dinámicos3Estado y UbicaciónSituar la pieza operativamente4ConfirmaciónValidación final + creación🟦 PASO 1 · Clasificación de la piezaID pantalla: UX-INV-WZ-01-S01Objetivo funcional:Definir Categoría + Subcategoría, base estructural de toda la ficha.CamposCampoTipoObligatorioOrigenCategoríaSelectSíinv_categorySubcategoríaSelect dependienteSíinv_subcategoryReglas UXSubcategoría filtrada por categoría (FK compuesta).Al cambiar categoría:Se limpia subcategoría.Se invalida cualquier dato posterior del wizard.ValidacionesCategoría obligatoria.Subcategoría obligatoria.Combinación válida (consistencia cat–subcat).AccionesSiguiente → solo si ambos campos válidos.Cancelar → aborta wizard sin persistir nada.🟦 PASO 2 · Características de la pieza (Ficha dinámica)ID pantalla: UX-INV-WZ-01-S02Objetivo funcional:Capturar atributos exactamente según Anexo B + C + D.Construcción de la pantalla (automática)Al entrar:El sistema ejecuta ComputeEffectiveAttributeRules()Se renderizan atributos según reglas:TipoRenderOVisible · Editable · ObligatorioOPVisible · Editable · OpcionalC (inactivo)Visible · Deshabilitado · HintC (activo)Visible · Editable · ObligatorioNA❌ No renderizadoComportamiento dinámicoCada cambio de valor:recalcula reglaspuede activar/desactivar Csin perder valores previosTipos de campo (según data_type)TextNumberBooleanDateSelect (dominio cerrado/semi-cerrado)Validaciones en tiempo realTipo de datoDominio correctoActivación visual inmediata de CMensajes UX normadosC inactivo:“Este campo se activará cuando se cumpla la condición correspondiente.”Error en obligatorio:“Este campo es obligatorio según las características seleccionadas.”AccionesAnterior → vuelve a Clasificación (limpia atributos).Siguiente → solo si:todos los O y C activos están informadosno hay errores de tipo/dominio.🟦 PASO 3 · Estado y Ubicación inicialID pantalla: UX-INV-WZ-01-S03Objetivo funcional:Definir snapshot operativo inicial de la pieza.CamposCampoTipoObligatorioOrigenEstado inicialSelectSíinv_operational_stateUbicación inicialSelectSíinv_locationReglas UXAmbos campos obligatorios.Estados finales no seleccionables (si RF lo define).Ubicaciones filtradas por tipo si aplica (opcional).Nota funcional visible (informativa)“El sistema registrará automáticamente el movimiento de creación de la pieza.”AccionesAnteriorSiguiente (si ambos campos válidos)🟦 PASO 4 · Confirmación y creaciónID pantalla: UX-INV-WZ-01-S04Objetivo funcional:Revisión final + creación atómica.Resumen mostrado (solo lectura)Bloque 1 · ClasificaciónCategoríaSubcategoríaBloque 2 · CaracterísticasLista completa de atributos aplicablesIncluye:OOPC activos e inactivosNA no apareceBloque 3 · Estado inicialEstadoUbicaciónValidación final (al pulsar “Crear pieza”)Se ejecuta SR-04 completa:Reglas efectivasTiposDominiosObligatoriedadPersistencia (si OK)En una sola transacción:Crear inv_itemCrear inv_item_attribute_valueCrear inv_movement (CREATE)Generar item_code + QRResultadoMensaje éxito:“Pieza creada correctamente.”Redirección a:Ficha completa (modo consulta)con QR visible⛔ Errores bloqueantes (resumen UX)SituaciónComportamientoFalta atributo obligatorioBloqueo + foco en campoDominio inválidoError de campoCondicional activo sin valorBloqueoEstado o ubicación no definidosBloqueoError transaccionalMensaje técnico controlado📦 Resultado de A10.1Con este wizard:El dato nace una sola vezEl usuario no puede crear incoherenciasLa UX refleja exactamente el modelo funcionalEl backend puede implementar sin interpretar nadaA10.2 - 🧾 FICHA DE PIEZA · UX FUNCIONALModo Consulta & Modo EdiciónID UX: UX-INV-FICHA-01Casos de uso base:UC-INV-02 (Consulta)UC-INV-03 (Edición)UC-INV-04 (Movimientos)Reglas aplicadas: SR-03, SR-04, SR-06Patrón aplicado: LES-UX-PATTERN-C1️⃣ Principio rector de la FichaLa ficha no es una pantalla “libre”.Es una vista compuesta de:snapshot actual (inv_item)valores vigentes (inv_item_attribute_value)reglas efectivas (motor SR-03)historial (movimientos, reservas, reparaciones)La ficha no altera estado ni ubicación directamente.2️⃣ Estructura general de la FichaLa ficha se organiza en bloques funcionales fijos, siempre en el mismo orden:IdentificaciónClasificaciónEstado operativo actualCaracterísticas (atributos dinámicos)Operaciones activas (reserva / reparación)Historial (solo consulta)Acciones disponibles3️⃣ MODO CONSULTA (Read-only)🟦 BLOQUE 1 · IdentificaciónObjetivo: Identificar inequívocamente la pieza.Campos (solo lectura):Código de pieza (item_code)QR (visual + escaneable)Fecha de creaciónUsuario creador🟦 BLOQUE 2 · ClasificaciónCampos (solo lectura):CategoríaSubcategoría⚠️ No editable desde ficha(Cambiar clasificación implica revalidación completa → caso de uso específico).🟦 BLOQUE 3 · Estado operativo actualCampos (solo lectura):Estado actualUbicación actualFecha último movimiento📌 Texto informativo fijo:“El estado y la ubicación solo pueden modificarse mediante un movimiento.”🟦 BLOQUE 4 · Características (Ficha dinámica)Construcción:Ejecutar ComputeEffectiveAttributeRules()Renderizar solo atributos aplicables (O / OP / C)NA no se muestraRepresentaciónTipoRepresentaciónOVisible, valor mostradoOPVisible, valor mostradoC activoVisible, valor mostradoC inactivoVisible, deshabilitado, valor mostrado + notaNA❌ No visibleNota visual estándar para C inactivo:“No aplicable en el estado actual.”🟦 BLOQUE 5 · Operaciones activasSe muestra solo si aplica:Reserva activaClienteFecha inicioFecha caducidadEstadoReparación activaTallerEstado de la ordenFecha envío🟦 BLOQUE 6 · HistorialSección colapsable (solo lectura):Movimientos (paginados)Eventos clave: CREATE, RESERVE, SEND/RETURN, etc.🟦 BLOQUE 7 · Acciones disponiblesBotones visibles según rol + estado:Editar fichaCambiar estado / ubicaciónApartar / liberarEnviar a taller / recibirImprimir etiqueta⚠️ Las acciones no editan campos directamente, abren casos de uso dedicados.4️⃣ MODO EDICIÓN (Edit attributes only)ActivaciónBotón “Editar ficha”Solo si:el estado de la pieza lo permiteel rol del usuario lo permite🟧 Diferencias clave en Modo EdiciónBloques editables✅ Solo BLOQUE 4 · Características❌ No editables:IdentificaciónClasificaciónEstadoUbicación🟧 BLOQUE 4 · Características (Edición)Render dinámicoMismas reglas que en wizard:O, OP, C visiblesNA ocultosC inactivos:visiblesdeshabilitadoscon hint normadoComportamiento dinámicoCada cambio:recalcula reglaspuede activar/desactivar CValores previos nunca se borran automáticamenteValidación al guardarAntes de confirmar:Ejecutar SR-04 completaVerificar:tiposdominiosO y C activos informadosMensajes UX normadosObligatorio no informado:“Este campo es obligatorio según las características seleccionadas.”Dominio inválido:“El valor seleccionado no pertenece a la lista permitida.”Intento editar C inactivo:“Este campo no es editable en el estado actual.”AccionesGuardar cambiosCancelar (descarta cambios locales)5️⃣ Transición Edición → ConsultaAl guardar correctamente:Persistir inv_item_attribute_valueNo se genera movimientoVolver automáticamente a Modo ConsultaMostrar mensaje:“Ficha actualizada correctamente.”6️⃣ Reglas explícitas de prohibición (Ficha)🚫 No editar estado/ubicación desde la ficha🚫 No editar clasificación desde la ficha🚫 No mostrar atributos NA🚫 No permitir guardar si hay C activos sin valor🚫 No recalcular reglas en frontend7️⃣ Resultado funcional de la FichaCon esta ficha:El usuario entiende el estado real de la piezaEl sistema no permite incoherenciasEl modelo de datos se refleja 1:1La UX es estable y predecibleEl sistema sigue siendo troncal y gobernable🔁 A10.3 · PANTALLAS DE MOVIMIENTOCambio de estado / ubicación · Reserva · TallerID UX base: UX-INV-MOV-01Casos de uso: UC-INV-04, UC-INV-05, UC-INV-06Reglas aplicadas: SR-06, SR-07, SR-08Principio troncal: Estado y ubicación solo cambian mediante movimiento registrado.0️⃣ Principios comunes a TODAS las pantallas de movimientoSiempre se crea un inv_movement.Nunca se edita directamente inv_item.operational_state_id o location_id.Transacción atómica: si falla el movimiento, no cambia el snapshot.Validación de concurrencia: el “from” debe coincidir con el snapshot actual.Estructura común de pantallaContexto de la pieza (solo lectura)Datos del movimientoConfirmación🟦 MOV-01 · Cambio de estado y/o ubicación (genérico)ID UX: UX-INV-MOV-01-ADisparador: “Cambiar estado / ubicación”Actor: Dependienta / Admin1) Contexto de la pieza (solo lectura)Código + QRCategoría / SubcategoríaEstado actualUbicación actualFecha último movimiento2) Datos del movimientoCampoTipoObligatorioTipo de movimientoSelectSíEstado destinoSelectCondicionalUbicación destinoSelectCondicionalMotivoText / SelectSíReglas UXEl tipo de movimiento determina qué campos destino se muestran:Cambio solo de estado → mostrar estado destinoTransferencia → mostrar ubicación destinoAmbos → mostrar ambosNo se permite seleccionar:mismo estadomisma ubicación3) ConfirmaciónBotón Confirmar movimientoTexto fijo:“Este cambio quedará registrado en el historial de la pieza.”Validaciones“from” coincide con snapshot actualAl menos uno de los destinos cambiaMotivo obligatorioResultadoCrear inv_movementActualizar snapshot en inv_itemVolver a ficha (modo consulta)🟦 MOV-02 · Apartar pieza (Reserva)ID UX: UX-INV-MOV-01-BDisparador: “Apartar”Actor: Dependienta / Admin1) Contexto (solo lectura)PiezaEstado actual (no final)Ubicación actual2) Datos de la reservaCampoTipoObligatorioClienteSelect / Alta rápidaSíFecha caducidadDateSíObservacionesTextNoReglas UXNo se muestra si existe reserva activaFecha mínima = hoyFecha máxima = política negocio (si aplica)3) ConfirmaciónTexto fijo:“La pieza quedará reservada y no estará disponible para otras operaciones.”Persistencia (transacción)Crear inv_reservation (ACTIVE)Crear inv_movement (RESERVE)Cambiar estado → RESERVEDResultadoVolver a fichaMostrar bloque “Reserva activa”🟦 MOV-03 · Liberar reservaID UX: UX-INV-MOV-01-CDisparador: “Liberar reserva”Actor: Admin (o rol autorizado)CamposCampoTipoObligatorioMotivo liberaciónText / SelectSíPersistenciaCerrar inv_reservationCrear inv_movement (UNRESERVE)Estado vuelve a AVAILABLE (o el definido)🟦 MOV-04 · Enviar a taller (Reparación)ID UX: UX-INV-MOV-01-DDisparador: “Enviar a taller”Actor: Dependienta / Admin1) ContextoPiezaEstado / Ubicación actual2) Datos de la reparaciónCampoTipoObligatorioTallerSelectSíDescripción trabajoTextSíFecha envíoDateAuto (hoy)PersistenciaCrear inv_repair_order (OPEN)Crear inv_movement (SEND_TO_WORKSHOP)Estado → IN_REPAIRUbicación → EXTERNAL_WORKSHOP🟦 MOV-05 · Recepción desde tallerID UX: UX-INV-MOV-01-EDisparador: “Recibir de taller”Actor: Dependienta / AdminCamposCampoTipoObligatorioResultadoSelect (OK / Incidencia)SíObservacionesTextNoPersistenciaActualizar inv_repair_order (RECEIVED/CLOSED)Crear inv_movement (RETURN_FROM_WORKSHOP)Estado → definido por negocioUbicación → tienda / almacén🟦 MOV-06 · Venta / cierre (si aplica en inventario)(Incluido si RF-INV contempla estado final)ID UX: UX-INV-MOV-01-FRegla críticaEstado final bloquea edición de fichaHistorial permanece consultable⛔ Prohibiciones explícitas (movimientos)🚫 No editar ficha durante movimiento🚫 No permitir movimientos sin motivo🚫 No permitir movimiento si snapshot cambió🚫 No permitir reservas múltiples activas🚫 No permitir edición directa de estado/ubicación📦 Resultado de A10.3Con estas pantallas:Toda la operativa queda trazadaEl inventario sigue siendo troncalEl usuario entiende qué está haciendo y por quéEl sistema es auditable, robusto y coherente🧱 Estado del proyecto tras A10A este punto tienes TODO el puente completo:Modelo funcional ✔️Modelo técnico ✔️Reglas de servicio ✔️Casos de uso ✔️Patrón UX ✔️Wizard ✔️Ficha ✔️Movimientos ✔️
