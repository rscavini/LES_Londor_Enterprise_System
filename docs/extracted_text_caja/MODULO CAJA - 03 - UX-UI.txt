PASO 3 â€” UX Funcional Â· MÃ³dulo Caja
Mapa de navegaciÃ³n (roles)
MenÃº Dependienta
Caja del dÃ­a
Registrar movimiento (solo flujos permitidos)
HistÃ³rico (solo lectura) (opcional segÃºn permisos)
Emitir factura (solo dentro del flujo de venta, no como pantalla suelta)
MenÃº Administrador
Caja del dÃ­a (control)
Apertura / Cierre
Movimientos (consulta + auditorÃ­a)
Ajustes / Contra-movimientos
Incidencias (descuadres, bloqueos)
Facturas (consulta / estado Verifactu) (si se expone desde Caja)

Pantallas UX (P-CASH-xx)
ğŸŸ¦ P-CASH-01 Â· Caja del dÃ­a (Resumen operativo)
Objetivo: ver estado de caja, totales y â€œquÃ© falta por hacerâ€ en 5 segundos.
Rol: Dependienta / Admin (con diferencias de permisos)
Elementos visibles
Estado: No abierta / Abierta / Cerrada
Saldo inicial (si abierta/cerrada)
Totales por medio de pago (Efectivo/Tarjeta/Transferencia/Bizum/Vale/Mixto)
Total entradas / Total salidas
Total teÃ³rico
Alertas:
â€œCaja no abiertaâ€
â€œPendiente cierreâ€
â€œDescuadre detectadoâ€
â€œMovimientos pendientes de justificarâ€ (Admin)
Acciones
Abrir caja (si rol permite) â†’ P-CASH-02
Registrar cobro de venta (normalmente viene desde flujo de venta)
Registrar pago compra cliente â†’ P-CASH-06 (si rol permite iniciar)
Ir a movimientos â†’ P-CASH-04
Cerrar caja â†’ P-CASH-03
RF cubiertos: 010â€“015, 020â€“022, 070, 090â€“092

ğŸŸ¦ P-CASH-02 Â· Apertura de caja
Objetivo: abrir la caja de una tienda con saldo inicial trazado.
Rol: Admin (o Dependienta si se autoriza)
Campos
Tienda (si usuario opera en varias)
Saldo inicial (obligatorio)
Observaciones (opcional)
ConfirmaciÃ³n
Validaciones
Si ya existe caja abierta â†’ no permite segunda apertura
Registra usuario + timestamp
Resultado
Caja pasa a Abierta
Navega a P-CASH-01
RF: 010â€“012

ğŸŸ¦ P-CASH-03 Â· Cierre y arqueo de caja
Objetivo: cerrar caja con arqueo, diferencias y trazabilidad.
Rol: Admin (y Dependienta solo si se autoriza)
Secciones
Resumen teÃ³rico
Totales por medio de pago
Total teÃ³rico entradas/salidas
Total teÃ³rico final
Conteo real
Efectivo contado (obligatorio)
Tarjeta (lectura; editable solo Admin si hay incidencia)
Transferencia/Bizum/Vale (lectura; con campo â€œverificadoâ€)
Diferencias
Diferencia calculada automÃ¡ticamente
Campo â€œMotivo/ObservaciÃ³nâ€ obligatorio si descuadre
Acciones
Cerrar caja (si diferencia = 0)
Cerrar con descuadre (Admin + motivo obligatorio)
â€œMarcar para revisiÃ³nâ€ (Admin)
RF: 013â€“015, 100â€“102

ğŸŸ¦ P-CASH-04 Â· Movimientos de Caja (Listado + filtros)
Objetivo: auditorÃ­a rÃ¡pida y trazabilidad operativa.
Rol: Dependienta (lectura restringida) / Admin (completo)
Filtros
Fecha (por defecto: hoy)
Tienda
Tipo de movimiento
Medio de pago
Usuario
Evento origen (Venta / Compra / EmpeÃ±o / Ajuste)
Estado factura (Con factura / Sin factura / Rectificada) (si se muestra)
Tabla
Hora
Tipo
Sentido (entrada/salida)
Importe
Medio pago
Usuario
Origen (link a Venta/Compra/EmpeÃ±o)
Factura (si existe) (link)
Estado Verifactu (si aplica) (badge)
Acciones
Ver detalle â†’ P-CASH-05
Generar contra-movimiento â†’ P-CASH-10 (Admin)
RF: 020â€“022, 030â€“031, 070, 100â€“102, 080â€“084

ğŸŸ¦ P-CASH-05 Â· Movimiento de Caja (Detalle inmutable)
Objetivo: ver todo lo que explica ese movimiento y su encadenamiento.
Rol: Dependienta (lectura) / Admin (lectura + acciones permitidas)
Bloques
IdentificaciÃ³n: MovementId, CajaId, tienda, usuario, timestamp
EconÃ³mico: tipo, sentido, importe, medio pago
Origen funcional: VentaId / CompraId / EmpeÃ±oId / AjusteId (segÃºn)
Factura:
FacturaId (si existe)
NÃºmero fiscal
Estado Verifactu
Evidencias / documentos asociados (links)
Acciones
(Admin) â€œCrear contra-movimientoâ€
(Admin) â€œIniciar rectificativaâ€ (dispara mÃ³dulo FacturaciÃ³n, no se emite aquÃ­)
RF: 020â€“022, 080â€“084, 100â€“102

ğŸŸ¦ P-CASH-06 Â· Compra a cliente (Pago + ficha legal)
Objetivo: registrar pago y evidencias legales de la operaciÃ³n.
Rol: Dependienta autorizada / Admin
Paso 1 â€” Datos base
Cliente (buscar/crear) (obligatorio)
Tipo compra: Oro / Pieza(s)
Importe a pagar (obligatorio)
Medio de pago (obligatorio)
Observaciones
Paso 2 â€” Evidencias legales
Foto DNI (obligatoria)
Foto(s) pieza(s) (obligatoria)
ConfirmaciÃ³n de consentimiento / check legal (si aplica)
Paso 3 â€” ConfirmaciÃ³n
Resumen
Confirmar â†’ genera:
Movimiento Caja (Salida)
Ficha legal de compra
Marcado â€œEn custodia legalâ€
Temporizador/fecha objetivo +15 dÃ­as
Validaciones
No permite confirmar sin fotos requeridas
No permite operar si caja no estÃ¡ abierta
Asociaciones obligatorias: Cliente + Pieza(s) + Movimiento
RF: 050â€“056, 070, 010â€“012, 020â€“022

ğŸŸ¦ P-CASH-07 Â· Ficha legal de compra (Consulta)
Objetivo: consultar dossier legal y su estado.
Rol: Admin (y Dependienta solo lectura si se decide)
Contenido
Cliente + identificaciÃ³n
Fotos DNI + fotos piezas
Fecha/hora, tienda, usuario
Movimiento de Caja asociado
Piezas asociadas (links a inventario)
Estado legal:
En custodia (con contador de dÃ­as)
Liberada
Incidencia / Bloqueada
Acciones (Admin)
Registrar â€œEnvÃ­o a autoridadâ€ (estado + fecha) (sin detallar canal aÃºn)
Marcar incidencia
Ejecutar â€œLiberaciÃ³n legalâ€ (evento explÃ­cito)
RF: 052â€“056

ğŸŸ¦ P-CASH-08 Â· Bandeja â€œCustodia legalâ€ (15 dÃ­as)
Objetivo: control de piezas retenidas y liberaciÃ³n controlada.
Rol: Admin
Tabla
OperaciÃ³n / Ficha legal
Cliente
Tienda
Fecha compra
DÃ­as transcurridos / DÃ­as restantes
Estado (En custodia / Lista para liberar / Incidencia)
Acciones
Abrir ficha legal â†’ P-CASH-07
Liberar legalmente (cuando corresponda) â†’ confirmaciÃ³n + log
Bloquear por incidencia (motivo obligatorio)
RF: 054â€“056

ğŸŸ¦ P-CASH-09 Â· EmpeÃ±os (movimientos econÃ³micos vinculados)
Objetivo: registrar movimientos de caja asociados a eventos de empeÃ±o.
Rol: Dependienta / Admin (segÃºn permisos)
Subflujos
Cobro de intereses â†’ Entrada
RecuperaciÃ³n â†’ Entrada
(Otros eventos si aplica)
Elementos
SelecciÃ³n contrato de empeÃ±o
Cliente (autocompleta)
Importe
Medio de pago
Confirmar â†’ movimiento + vÃ­nculo
RF: 060â€“061, 020â€“022, 070

ğŸŸ¦ P-CASH-10 Â· Ajustes y contra-movimientos (Admin)
Objetivo: corregir sin editar: trazabilidad perfecta.
Rol: Admin
Flujo
Seleccionar movimiento origen (desde P-CASH-05 o listado)
Tipo correcciÃ³n:
Contra-movimiento total
Parcial (si se permite)
Motivo (obligatorio)
Confirmar â†’ crea nuevo movimiento vinculado al original
Validaciones
Nunca modifica el original
Deja rastro de usuario/fecha/motivo
RF: 100â€“102, 084

ğŸŸ¦ P-CASH-11 Â· Factura desde venta (Modal / Step en checkout)
Objetivo: emitir factura en el momento si el cliente la pide, sin romper flujo.
Rol: Dependienta / Admin
UI recomendada (dentro del flujo de cobro)
Toggle: â€œCliente solicita factura: SÃ­/Noâ€
Si SÃ­:
SelecciÃ³n/alta de cliente (datos fiscales)
ConfirmaciÃ³n datos
Emitir factura (llamada a FacturaciÃ³n)
Retorna: FacturaId + nÃºmero + estado Verifactu
Se muestra comprobante y se vincula al movimiento.
Reglas visibles para el usuario
â€œLa factura es inmodificable. Correcciones vÃ­a rectificativa.â€
RF: 080â€“084

Criterios UX transversales (para todo el mÃ³dulo)
Bloqueo si no hay caja abierta (mensaje claro + CTA a abrir)
Diferenciar operaciÃ³n (dependienta) vs auditorÃ­a (admin)
Todo lo â€œlegalâ€ y â€œfiscalâ€ con badges de estado (Custodia / Verifactu)
Inmutabilidad: no mostrar botones de â€œeditarâ€ movimientos nunca
Correcciones: siempre â€œGenerar contra-movimientoâ€ / â€œRectificativaâ€
