üìò FRaD ¬∑ M√ìDULO CAJA
LONDOR Enterprise System (LES)
Documento: Functional Requirements & Architecture Description (FRaD)
Versi√≥n: v1.0 ‚Äì Draft de control
Estado: En revisi√≥n
Rol: Documento rector funcional
√Åmbito: 3 tiendas LONDOR (multi-tienda, datos compartidos)

1. Objetivo y rol del m√≥dulo Caja
Objetivo general
El M√≥dulo de Caja tiene como objetivo registrar, gobernar y trazar todos los movimientos econ√≥micos reales derivados de la actividad diaria de LONDOR, garantizando:
Integridad financiera
Trazabilidad legal y operativa
Coherencia entre operaci√≥n, inventario y administraci√≥n
Base fiable para contabilidad y gobierno
Caja act√∫a como fuente √∫nica de verdad econ√≥mica operativa, no como un mero TPV.

Principio troncal
No existe dinero sin evento funcional.
No existe evento econ√≥mico sin movimiento de Caja.

2. Posici√≥n del m√≥dulo Caja en el LES
Caja es un m√≥dulo troncal de gobierno econ√≥mico, situado entre:
Operaci√≥n diaria (ventas, compras, empe√±os)
Inventario (movimiento f√≠sico de piezas)
Administraci√≥n y contabilidad
Caja valida econ√≥micamente la operaci√≥n, pero no sustituye a la contabilidad ni a la fiscalidad.

3. Alcance del m√≥dulo (IN / OUT)
3.1 Alcance IN (gestionado por Caja)
Apertura y cierre de caja por tienda y d√≠a
Registro de:
Cobros
Pagos
Entradas y salidas de efectivo
Asociaci√≥n obligatoria a:
Ventas
Compras a clientes (oro/piezas)
Devoluciones
Empe√±os
Cobro de intereses
Gesti√≥n de medios de pago
Cuadre y arqueo diario
Control por usuario, tienda y fecha

3.2 Alcance OUT (integrado, no gestionado)
Contabilidad general
Fiscalidad
Bancos
Reporting financiero avanzado
Caja alimenta estos sistemas mediante datos trazados y consolidados.

4. Principios de gobierno del dato en Caja
Todo movimiento de Caja tiene:
Origen funcional
Usuario responsable
Fecha y hora
Tienda
Medio de pago
Caja es inmutable:
No se edita
Se corrige mediante contra-movimiento
Caja es auditable por dise√±o
Caja es diaria y por tienda
No existen movimientos gen√©ricos ni libres

5. Entidad troncal: Movimiento de Caja
Cada operaci√≥n econ√≥mica genera un Movimiento de Caja con:
ID √∫nico no reutilizable
Referencia a:
Caja diaria
Evento funcional origen
Tipo de movimiento
Importe
Sentido (Entrada / Salida)
Medio de pago
Usuario y timestamp

6. Tipos de movimiento de Caja (nivel funcional)
Venta
Compra a cliente (oro / piezas)
Devoluci√≥n
Empe√±o
Cobro de intereses de empe√±o
Ajuste autorizado
Entrada manual (Admin)
Salida manual (Admin)
üìå Los tipos son dominio gobernado, no texto libre.

7. Caja diaria por tienda
7.1 Apertura de Caja
Obligatoria al inicio del d√≠a
Registra:
Usuario
Fecha y hora
Saldo inicial
Bloquea operaciones si no existe caja abierta

7.2 Operaci√≥n diaria
Todo movimiento:
Se asocia a una caja abierta
Se vincula a un evento funcional
No se permiten cobros o pagos fuera de caja

7.3 Cierre de Caja
Obligatorio
Incluye:
Totales por medio de pago
Te√≥rico vs real
Diferencias documentadas
Estado del cierre:
Cuadrado
Descuadrado (con observaci√≥n obligatoria)

8. Relaci√≥n con otros m√≥dulos

8.1 Venta
Una venta no se considera cerrada sin movimiento de Caja
Caja valida el cierre econ√≥mico
El movimiento queda trazado con:
Venta
Cliente
Pieza(s)

8.2 Inventario
Toda venta:
Genera movimiento de Caja
Dispara cambio de estado de pieza
Caja e Inventario quedan vinculados por ID com√∫n

8.3 Compra de oro / piezas a clientes (con trazabilidad legal)
La compra de oro o piezas a clientes es un proceso legalmente regulado, que debe quedar √≠ntegramente trazado a nivel econ√≥mico, documental y operativo.
Alcance funcional
Cuando se realiza una compra a un cliente, el sistema debe:
Registrar el pago al cliente como salida de Caja
Asociar la operaci√≥n a:
Cliente identificado
Pieza(s) adquirida(s)
Activar un circuito de trazabilidad legal obligatoria

Ficha legal de compra (obligatoria)
La operaci√≥n debe generar una ficha legal de compra, que incluya como m√≠nimo:
Identificaci√≥n del cliente
Datos personales
Documento identificativo (DNI o equivalente)
Evidencias visuales:
Fotograf√≠a del documento de identidad
Fotograf√≠as de la(s) pieza(s) adquirida(s)
Datos de la operaci√≥n:
Fecha y hora
Tienda
Usuario responsable
Importe pagado
Medio de pago
Asociaci√≥n directa con:
Movimiento de Caja
Registro de Inventario
Esta ficha es obligatoria y parte del cumplimiento legal.

Env√≠o a autoridad competente
El sistema debe contemplar el env√≠o de la documentaci√≥n a la autoridad competente (polic√≠a u organismo equivalente).
La operaci√≥n queda marcada como legalmente en custodia.

Periodo de custodia legal
Periodo reglamentario de 15 d√≠as naturales
Durante este periodo:
La pieza no puede venderse
No puede transformarse
No puede salir del control del sistema
El estado legal es independiente del estado operativo.

Liberaci√≥n o incidencia
Transcurrido el plazo sin comunicaci√≥n negativa:
La pieza queda liberada legalmente
Pasa a estado operativo normal
En caso de incidencia:
La pieza queda bloqueada
Se mantiene trazabilidad completa
üìå La liberaci√≥n legal es un evento expl√≠cito, no impl√≠cito.

8.4 Empe√±os
Registro de:
Entrega inicial
Cobro de intereses
Recuperaci√≥n
Adjudicaci√≥n
Cada evento econ√≥mico genera movimiento de Caja
Total trazabilidad cliente‚Äìpieza‚Äìdinero

9. Medios de pago
Medios de pago soportados (dominio controlado):
Efectivo
Tarjeta
Transferencia
Bizum
Vale / cr√©dito interno
Pago mixto

10. Roles y permisos
Dependienta
Registrar cobros est√°ndar
Registrar pagos est√°ndar
Consultar caja del d√≠a (solo lectura)
No puede:
Ajustar
Eliminar
Forzar cierres

Administrador
Todas las acciones anteriores
Ajustes documentados
Correcciones mediante contra-movimiento
Cierres forzados con justificaci√≥n

11. Reglas cr√≠ticas (no negociables)
No existe venta sin Caja
No existe pago sin evento funcional
No se editan movimientos
Toda correcci√≥n es trazable
Caja es diaria y por tienda

12. Preparaci√≥n para niveles posteriores
Este FRaD deja preparados:
Requerimientos funcionales RF-CASH
Pantallas UX funcionales
Casos de prueba
Integraci√≥n contable futura
Auditor√≠a y BI

13. Cierre
El M√≥dulo de Caja no es un TPV, sino un pilar de gobierno econ√≥mico y legal del LONDOR Enterprise System.
Este FRaD fija el marco estable sobre el que se desarrollar√°n los siguientes niveles, garantizando coherencia, trazabilidad y escalabilidad.


üìé ANEXO F-CAJA-FACT
Frontera funcional entre M√≥dulo Caja y M√≥dulo Facturaci√≥n
Documento asociado: FRaD ¬∑ M√≥dulo Caja
Rol del anexo: Gobierno de responsabilidades y l√≠mites funcionales
Estado: Definitivo (nivel FRaD)

A. Objetivo del anexo
Definir de forma clara, expl√≠cita y no ambigua la frontera funcional entre:
M√≥dulo Caja (registro econ√≥mico real)
M√≥dulo Facturaci√≥n (certificaci√≥n fiscal y legal)
Este anexo act√∫a como contrato funcional, evitando:
solapamientos,
duplicidades,
errores de dise√±o futuros,
incumplimientos normativos.

B. Principio rector LES
Caja registra el dinero.
Facturaci√≥n certifica legalmente la operaci√≥n.
Ambos m√≥dulos est√°n estrechamente coordinados, pero no mezclados.

C. Responsabilidades exclusivas por m√≥dulo
C.1 Responsabilidades del M√≥dulo Caja
El M√≥dulo Caja es responsable de:
Registrar todos los movimientos econ√≥micos reales
Gestionar:
Apertura y cierre diario
Arqueo
Cuadre
Asociar cada movimiento a:
Evento funcional (venta, compra, empe√±o‚Ä¶)
Cliente (si aplica)
Usuario
Tienda
Determinar si una operaci√≥n:
Requiere factura
No requiere factura
Disparar la emisi√≥n de factura cuando procede
Mantener inmutabilidad de los movimientos
üìå Caja NO:
Calcula impuestos oficiales
Gestiona numeraci√≥n fiscal
Emite documentos fiscales por s√≠ sola

C.2 Responsabilidades del M√≥dulo Facturaci√≥n
El M√≥dulo Facturaci√≥n es responsable de:
Emitir facturas oficiales
Garantizar:
Numeraci√≥n √∫nica
Numeraci√≥n incremental y consecutiva sin saltos
No duplicaci√≥n
No modificaci√≥n
No eliminaci√≥n
Gestionar:
Facturas completas
Facturas simplificadas
Facturas rectificativas
Integrarse con:
Verifactu
Sistemas fiscales futuros (SII, AEAT, etc.)
Custodiar:
Documentos fiscales
Huellas digitales
Encadenamiento fiscal
üìå Facturaci√≥n NO:
Registra pagos reales
Gestiona arqueos
Modifica importes ya cobrados

D. Relaci√≥n operativa entre m√≥dulos (flujo)
Flujo l√≥gico est√°ndar (venta con posible factura)
[Evento funcional: Venta]
            ‚îÇ
            ‚ñº
     [M√ìDULO CAJA]
  ‚îÄ Registra cobro
  ‚îÄ Medio de pago
  ‚îÄ Usuario / tienda
  ‚îÄ ¬øFactura requerida?
            ‚îÇ
            ‚îú‚îÄ‚îÄ NO ‚îÄ‚îÄ‚ñ∫ Venta cerrada (sin factura)
            ‚îÇ
            ‚îî‚îÄ‚îÄ S√ç
                 ‚ñº
        [M√ìDULO FACTURACI√ìN]
  ‚îÄ Genera factura oficial
  ‚îÄ Asigna n√∫mero fiscal
  ‚îÄ Aplica Verifactu
  ‚îÄ Devuelve ID de factura
                 ‚îÇ
                 ‚ñº
     [M√ìDULO CAJA]
  ‚îÄ Vincula factura al movimiento
  ‚îÄ Movimiento queda cerrado
E. Reglas de integridad entre Caja y Facturaci√≥n
Una factura ‚Üî un √∫nico movimiento de Caja
Un movimiento de Caja:
puede NO tener factura
puede tener una sola factura
Una factura:
nunca se edita
nunca se elimina
nunca se renumera
Errores:
se corrigen mediante:
factura rectificativa
contra-movimientos de Caja
La trazabilidad es:
econ√≥mica (Caja)
fiscal (Facturaci√≥n)
funcional (Venta / Inventario)

F. Casos especiales contemplados
Venta sin factura ‚Üí ticket o registro interno
Venta con factura solicitada en el momento
Emisi√≥n posterior NO permitida sin flujo reglado
Factura rectificativa:
genera nuevo documento fiscal
se vincula a movimientos ya existentes
Compra a cliente:
puede o no requerir factura seg√∫n normativa
Caja decide, Facturaci√≥n ejecuta

G. Evoluci√≥n futura controlada
Este dise√±o permite, sin romper nada:
Activar Verifactu obligatorio
Integrar SII
Cambiar normativa fiscal
Externalizar Facturaci√≥n
Auditor√≠as completas

H. Cierre del anexo
Con este anexo queda formalmente fijada la frontera entre Caja y Facturaci√≥n, garantizando:
Cumplimiento normativo
Escalabilidad
Gobierno del dato
Coherencia LES
Este anexo es vinculante para:
RF
UX
Desarrollo
Auditor√≠a

