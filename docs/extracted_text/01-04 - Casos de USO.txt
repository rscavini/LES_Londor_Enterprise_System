UC-INV-01 — Alta de pieza (Wizard / creación)Actor principal: Dependienta / AdminDisparador: “Alta nueva pieza” (manual o por recepción/compra)Precondiciones:Catálogos activos: categorías/subcategorías, atributos, dominios, ubicaciones, estados.Usuario autenticado (rol válido). 02-04 - MATRIZ PANTALLAPostcondiciones (éxito):inv_item creado con item_id, item_code, qr, clasificación, estado y ubicación iniciales.inv_movement creado (CREATE).Ficha queda consistente respecto a obligatoriedad por subcategoría.Flujo principal:Usuario inicia “Alta nueva pieza”.Selecciona Categoría y Subcategoría.El sistema construye ficha dinámica (atributos aplicables y obligatorios).Usuario introduce los valores de atributos (incluye listas por dominios). 01-02 - FRaD - Anexo D - Domini…Usuario define Ubicación inicial y Estado inicial.Usuario confirma alta.El sistema valida tipado + dominio + obligatoriedad efectiva.El sistema crea pieza + movimiento CREATE (transacción atómica).El sistema devuelve la ficha completa con QR/código y confirma creación.Flujos alternativos / errores:A1: Subcategoría incompatible con categoría ⇒ error, no permite continuar.A2: Falta un atributo obligatorio (O / condicional activado) ⇒ error con lista de campos faltantes. 01-02 - FRaD - Anexo C - Defini…A3: Valor de lista fuera de dominio ⇒ error. 01-02 - FRaD - Anexo D - Domini…A4: Duplicidad de item_code o QR ⇒ error (conflicto). 02-01 - DOCUMENTO RFReglas / SR aplicadas: SR-01, SR-03, SR-04RF-INV: 002/003, 010–013, 030–033, 034–036, 040–044UC-INV-02 — Consultar ficha completa de piezaActor: Dependienta / AdminDisparador: Escanear QR / buscar código / abrir fichaPrecondiciones: La pieza existe.Postcondiciones: Se muestra ficha consistente + historial.Flujo principal:Usuario busca pieza por QR o código.Sistema recupera núcleo (clasificación/estado/ubicación).Sistema recupera valores vigentes de atributos.Sistema calcula reglas efectivas (para saber qué mostrar/validar). 01-02 - FRaD - Anexo C - Defini…Sistema muestra historial de movimientos (paginado).Sistema muestra reserva/reparación activa si aplica.Alternativos / errores:A1: No existe pieza ⇒ “no encontrada”.A2: Usuario sin permisos ⇒ acceso denegado. 02-04 - MATRIZ PANTALLAReglas / SR: SR-10, SR-03RF-INV: 013, 020–024, 036, 040–044UC-INV-03 — Editar ficha dinámica (valores de atributos)Actor: Dependienta / AdminDisparador: “Editar ficha” en pieza existentePrecondiciones:Pieza existe.No está en estado final no editable (si aplica). 02-01 - DOCUMENTO RFPostcondiciones:Valores actualizados (upsert) respetando tipado, dominios y obligatoriedad.Flujo principal:Usuario abre ficha y pulsa “Editar”.Sistema obtiene reglas efectivas para esa subcategoría (qué es editable/obligatorio). 01-02 - FRaD - Anexo C - Defini…Usuario modifica campos permitidos.Sistema valida:atributo aplicable (no NA),tipo correcto,dominio correcto,obligatorios completos (post-merge).Sistema guarda valores vigentes.Sistema devuelve ficha actualizada.Alternativos / errores:A1: Usuario intenta guardar valor de atributo NA ⇒ error. 01-02 - FRaD - Anexo C - Defini…A2: Tipo incorrecto o dominio inválido ⇒ error. 01-02 - FRaD - Anexo D - Domini…A3: Faltan obligatorios ⇒ error y lista de campos.Reglas / SR: SR-03, SR-04RF-INV: 032–036, 013UC-INV-04 — Cambiar estado y/o ubicación (Movimiento)Actor: Dependienta / AdminDisparador: “Transferir”, “Cambiar estado”, “Entrada/Salida”, etc.Precondiciones:Pieza existe.Usuario autorizado.Acción permitida por el estado actual (si aplica).Postcondiciones:Movimiento registrado.Estado/ubicación actual actualizados coherentemente.last_movement_at actualizado.Flujo principal:Usuario elige acción (tipo de movimiento) y define destino (estado y/o ubicación).Sistema valida “from” coincide con el estado/ubicación actual.Sistema registra movimiento con mínimos obligatorios (usuario, fecha, motivo, from/to).Sistema actualiza snapshot en inv_item (transacción).Sistema devuelve ficha actual + historial actualizado.Alternativos / errores:A1: Intento de cambio directo sin movimiento ⇒ bloqueado. 02-01 - DOCUMENTO RFA2: From no coincide (condición de carrera) ⇒ error “estado cambiado por otro usuario”.A3: Movimiento no cambia nada ⇒ error.Reglas / SR: SR-06RF-INV: 040–044, 041, 042UC-INV-05 — Apartar / reservar piezaActor: Dependienta / AdminDisparador: “Apartar” desde ficha o proceso comercialPrecondiciones:Pieza no está vendida/cerrada.Existe cliente o se crea/selecciona cliente. 02-04 - MATRIZ PANTALLANo existe reserva activa previa para la pieza.Postcondiciones:Reserva activa creada.Movimiento RESERVE registrado.Estado de pieza actualizado a reservado.Flujo principal:Usuario pulsa “Apartar”.Selecciona/crea cliente.Define fecha de caducidad.Sistema valida unicidad “reserva activa por pieza”.Sistema crea reserva + movimiento + cambia estado a reservado (transacción).Alternativos / errores:A1: Ya existe reserva activa ⇒ error y se muestra la existente.A2: Falta cliente ⇒ error.Reglas / SR: SR-07, SR-06RF-INV: 050–055 + 040–044UC-INV-06 — Enviar a taller / recibir de taller (Reparación/personalización)Actor: Dependienta / AdminDisparador: “Enviar a taller” / “Recibir”Precondiciones:Pieza existe.Taller existe/seleccionable. 02-04 - MATRIZ PANTALLAPostcondiciones:Orden de reparación creada/actualizada.Movimientos SEND_TO_WORKSHOP / RETURN_FROM_WORKSHOP registrados.Estado/ubicación actual coherente con el evento.Flujo principal (Enviar):Usuario selecciona “Enviar a taller”.Selecciona taller y describe trabajo.Sistema crea orden (OPEN) y registra movimiento a ubicación “taller externo” y estado “en reparación”. 02-04 - MATRIZ PANTALLAFlujo principal (Recibir):4) Usuario registra recepción.5) Sistema actualiza orden (RECEIVED/CLOSED según caso) y registra movimiento de retorno.Alternativos / errores:A1: Taller no existe ⇒ error.A2: Pieza en estado incompatible ⇒ error (si definido).Reglas / SR: SR-08, SR-06RF-INV: 060–064 + 040–044UC-INV-07 — Imprimir / reimprimir etiquetaActor: Dependienta / AdminDisparador: “Imprimir etiqueta”Precondiciones: Pieza existe.Postcondiciones: Registro de impresión creado con snapshot de etiqueta.Flujo principal:Usuario pulsa “Imprimir etiqueta”.Sistema genera contenido con item_code + QR + datos básicos según RF. 02-02 - UX-UI · Wireframes func…Sistema registra inv_label_print_log (print).Se envía a impresora (fuera del alcance BD).Reimpresión:5) Usuario pulsa “Reimprimir”.6) Sistema solicita motivo (si definido) y registra log (reprint).Alternativos / errores:A1: No hay impresora configurada (técnico) ⇒ error operativo.Reglas / SR: SR-09RF-INV: 090–092Resultado de esta fase (entregable)7 casos de uso troncales cerrados, con mapeo a SR y RF-INV, listos para:derivar endpoints,generar casos de prueba,y mapear a pantallas.
